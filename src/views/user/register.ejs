<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="<%= csrfToken %>">
  <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å - Fortune App</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* Background decorations */
    body::before {
      content: '‚ú®';
      position: absolute;
      top: 10%;
      left: 10%;
      font-size: 30px;
      opacity: 0.3;
      animation: float 4s ease-in-out infinite;
    }

    body::after {
      content: 'üåü';
      position: absolute;
      bottom: 15%;
      right: 15%;
      font-size: 25px;
      opacity: 0.3;
      animation: float 4s ease-in-out infinite 2s;
    }

    .star-decoration {
      position: absolute;
      font-size: 20px;
      opacity: 0.2;
      pointer-events: none;
    }

    .star1 {
      top: 20%;
      right: 20%;
      animation: sparkle 3s infinite;
    }

    .star2 {
      bottom: 30%;
      left: 20%;
      animation: sparkle 3s infinite 1s;
    }

    .star3 {
      top: 60%;
      left: 5%;
      animation: sparkle 3s infinite 2s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px) rotate(0deg);
      }

      50% {
        transform: translateY(-15px) rotate(180deg);
      }
    }

    @keyframes sparkle {

      0%,
      100% {
        transform: scale(1) rotate(0deg);
        opacity: 0.2;
      }

      50% {
        transform: scale(1.3) rotate(180deg);
        opacity: 0.5;
      }
    }

    .register-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 25px;
      padding: 40px 35px;
      width: 100%;
      max-width: 450px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .register-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      animation: shimmer 4s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 35px;
      position: relative;
      z-index: 1;
    }

    .app-icon {
      font-size: 60px;
      margin-bottom: 15px;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from {
        filter: drop-shadow(0 0 10px rgba(255, 154, 158, 0.5));
      }

      to {
        filter: drop-shadow(0 0 20px rgba(255, 154, 158, 0.8));
      }
    }

    .app-title {
      font-size: 28px;
      font-weight: bold;
      background: linear-gradient(135deg, #ff9a9e, #fecfef);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .app-subtitle {
      color: #666;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .register-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .register-subtitle {
      color: #888;
      font-size: 14px;
    }

    .form-container {
      position: relative;
      z-index: 1;
    }

    .form-group {
      margin-bottom: 25px;
      position: relative;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
      font-size: 14px;
      position: relative;
    }

    .form-label::after {
      content: ' *';
      color: #e74c3c;
      font-weight: bold;
    }

    .form-input {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #e1e8ed;
      border-radius: 15px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
      outline: none;
      position: relative;
    }

    .form-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    .form-input:valid {
      border-color: #27ae60;
    }

    .form-input:invalid:not(:placeholder-shown) {
      border-color: #e74c3c;
    }

    .input-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      color: #bbb;
      pointer-events: none;
      transition: all 0.3s ease;
    }

    .form-input:focus+.input-icon {
      color: #667eea;
    }

    .form-input:valid+.input-icon {
      color: #27ae60;
    }

    .form-input:invalid:not(:placeholder-shown)+.input-icon {
      color: #e74c3c;
    }

    .error-message {
      color: #e74c3c;
      font-size: 12px;
      margin-top: 5px;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .form-input:invalid:not(:placeholder-shown)~.error-message {
      opacity: 1;
      transform: translateY(0);
    }

    .date-input-group {
      display: grid;
      grid-template-columns: 1.5fr 1.5fr 1fr;
      gap: 12px;
    }

    .date-input-group select {
      padding: 15px 45px 15px 15px;
      border: 2px solid #e1e8ed;
      border-radius: 15px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
      outline: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      cursor: pointer;
      text-overflow: ellipsis;
      white-space: nowrap;
      overflow: hidden;
      min-width: 0;
    }

    .date-input-group select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
    }

    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á */
    #birthYear {
      font-weight: 600;
      color: #333;
    }

    #birthMonth {
      font-weight: 500;
      color: #555;
    }

    #birthDay {
      font-weight: 500;
      color: #555;
      text-align: center;
    }

    /* Responsive ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
    @media (max-width: 480px) {
      .date-input-group {
        grid-template-columns: 2fr 1.5fr 1fr;
        gap: 8px;
      }

      .date-input-group select {
        padding: 12px 35px 12px 10px;
        font-size: 14px;
        background-position: right 8px center;
        background-size: 14px;
      }
    }

    @media (max-width: 380px) {
      .date-input-group {
        grid-template-columns: 1.4fr 1.2fr 1fr;
        gap: 6px;
      }

      .date-input-group select {
        padding: 10px 30px 10px 8px;
        font-size: 13px;
      }
    }

    @media (max-width: 320px) {
      .date-input-group {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .date-input-group select {
        padding: 12px 40px 12px 12px;
        font-size: 14px;
      }
    }

    .register-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    .register-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .register-btn:hover::before {
      left: 100%;
    }

    .register-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
    }

    .register-btn:active {
      transform: translateY(-1px);
    }

    .register-btn:disabled {
      background: #bbb;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .success-message {
      background: linear-gradient(135deg, #84fab0, #8fd3f4);
      color: white;
      padding: 15px 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(132, 250, 176, 0.3);
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }

      .register-container {
        padding: 30px 25px;
        border-radius: 20px;
      }

      .app-icon {
        font-size: 50px;
      }

      .app-title {
        font-size: 24px;
      }

      .register-title {
        font-size: 20px;
      }

      .form-input {
        padding: 12px 15px;
        font-size: 14px;
      }

      .register-btn {
        padding: 14px;
        font-size: 16px;
      }

      .date-input-group {
        gap: 8px;
      }
    }

    @media (max-width: 320px) {
      .register-container {
        padding: 25px 20px;
      }

      .app-title {
        font-size: 22px;
      }

      .date-input-group {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <!-- Background decorations -->
  <div class="star-decoration star1">‚≠ê</div>
  <div class="star-decoration star2">‚ú®</div>
  <div class="star-decoration star3">üåü</div>

  <div class="register-container">
    <div class="header">
      <div class="app-icon">üîÆ</div>
      <div class="app-title">Fortune App</div>
      <div class="register-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
      <div class="register-subtitle">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πà‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤</div>
    </div>

    <div class="success-message" id="successMessage">
      üéâ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Fortune App
    </div>

    <form class="form-container" id="registerForm" novalidate>
      <div class="form-group">
        <label class="form-label" for="firstName">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input type="text" id="firstName" name="firstName" class="form-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠"
          pattern="^[‡∏Å-‡πôa-zA-Z\s]{2,30}$" title="‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 2-30 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©" required>
        <span class="input-icon">üë§</span>
        <div class="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (2-30 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</div>
      </div>

      <div class="form-group">
        <label class="form-label" for="lastName">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" id="lastName" name="lastName" class="form-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
          pattern="^[‡∏Å-‡πôa-zA-Z\s]{2,30}$" title="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 2-30 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©" required>
        <span class="input-icon">üë•</span>
        <div class="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (2-30 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</div>
      </div>

      <div class="form-group">
        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (‡∏û.‡∏®.)</label>
        <div class="date-input-group">
          <select id="birthYear" name="birthYear" required>
            <option value="">‡∏õ‡∏µ ‡∏û.‡∏®.</option>
          </select>
          <select id="birthMonth" name="birthMonth" required>
            <option value="">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
            <option value="1">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
            <option value="2">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
            <option value="3">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
            <option value="4">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
            <option value="5">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
            <option value="6">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
            <option value="7">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
            <option value="8">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
            <option value="9">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
            <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
            <option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
            <option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
          </select>
          <select id="birthDay" name="birthDay" required>
            <option value="">‡∏ß‡∏±‡∏ô</option>
          </select>
        </div>
        <div class="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>
      </div>

      <div class="form-group">
        <label class="form-label" for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
        <input type="tel" id="phone" name="phone" class="form-input" placeholder="08X-XXX-XXXX"
          pattern="^(06|08|09)[0-9]{8}$" title="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 06, 08, ‡∏´‡∏£‡∏∑‡∏≠ 09 ‡πÅ‡∏•‡∏∞‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å"
          maxlength="10" required>
        <span class="input-icon">üì±</span>
        <div class="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (10 ‡∏´‡∏•‡∏±‡∏Å)</div>
      </div>

      <button type="submit" class="register-btn">
        ‚ú® ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚ú®
      </button>
    </form>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô (1-31)
    const daySelect = document.getElementById('birthDay');
    for (let i = 1; i <= 31; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      daySelect.appendChild(option);
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ ‡∏û.‡∏®. (2493-2568)
    const yearSelect = document.getElementById('birthYear');
    const currentYear = new Date().getFullYear(); // ‡∏õ‡∏µ ‡∏Ñ.‡∏®.
    const currentYearBE = currentYear + 543; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ ‡∏û.‡∏®. ‡∏à‡∏≤‡∏Å‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÑ‡∏õ 2493 (1950 ‡∏Ñ.‡∏®.)
    for (let i = currentYearBE; i >= 2493; i--) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = i;
      yearSelect.appendChild(option);
    }

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ form submission
    document.getElementById('registerForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö validation
      if (this.checkValidity()) {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
        const day = parseInt(document.getElementById('birthDay').value);
        const month = parseInt(document.getElementById('birthMonth').value);
        const yearBE = parseInt(document.getElementById('birthYear').value); // ‡∏õ‡∏µ ‡∏û.‡∏®.

        if (!day || !month || !yearBE) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
          return;
        }

        // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏û.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®. ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        const yearAD = yearBE - 543;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        const birthDate = new Date(yearAD, month - 1, day);
        if (birthDate.getDate() !== day || birthDate.getMonth() !== month - 1 || birthDate.getFullYear() !== yearAD) {
          alert('‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà');
          return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const today = new Date();
        if (birthDate > today) {
          alert('‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ');
          return;
        }

        // ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô validation ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        let full_name = document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value;
        let birth_date = `${yearAD}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;

        try {
          const liff_id = "2007423411-wVYbLZ63";
          await liff.init({ liffId: liff_id });
          console.log("LIFF Init Success");
        } catch (initError) {
          console.error("LIFF Init Error:", initError);
          return;
        }
        
        fetch('/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'authorization': `Bearer ${liff.getIDToken()}`,
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
          },
          body: JSON.stringify({
            full_name: full_name,
            birth_date: birth_date,
            phone: document.getElementById('phone').value
          })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
              document.getElementById('successMessage').style.display = 'block';

              // ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
              const submitBtn = document.querySelector('.register-btn');
              submitBtn.disabled = true;
              submitBtn.textContent = '‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';

              // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
              window.scrollTo({ top: 0, behavior: 'smooth' });
              setTimeout(() => {
                window.location.href = '/order/payment';
              }, 2000);

            } else {
              alert(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å');
          });

      } else {
        // ‡πÅ‡∏™‡∏î‡∏á validation errors
        this.reportValidity();
      }
    });

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö real-time validation
    const inputs = document.querySelectorAll('.form-input, select');
    inputs.forEach(input => {
      input.addEventListener('blur', function () {
        if (this.checkValidity()) {
          this.style.borderColor = '#27ae60';
        } else if (this.value !== '') {
          this.style.borderColor = '#e74c3c';
        }
      });

      input.addEventListener('input', function () {
        if (this.checkValidity()) {
          this.style.borderColor = '#27ae60';
        } else {
          this.style.borderColor = '#e1e8ed';
        }
      });
    });

    // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    document.getElementById('phone').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 10) {
        value = value.substring(0, 10);
      }
      e.target.value = value;
    });

    function updateDaysInMonth() {
      const yearBE = parseInt(document.getElementById('birthYear').value);
      const month = parseInt(document.getElementById('birthMonth').value);
      const daySelect = document.getElementById('birthDay');
      const currentDay = parseInt(daySelect.value);

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
      if (!yearBE || !month) {
        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 1-31
        daySelect.innerHTML = '<option value="">‡∏ß‡∏±‡∏ô</option>';
        for (let i = 1; i <= 31; i++) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = i;
          if (currentDay === i) {
            option.selected = true;
          }
          daySelect.appendChild(option);
        }
        return;
      }

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏û.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®.
      const yearAD = yearBE - 543;
      const daysInMonth = new Date(yearAD, month, 0).getDate();

      // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°
      daySelect.innerHTML = '<option value="">‡∏ß‡∏±‡∏ô</option>';

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      for (let i = 1; i <= daysInMonth; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        if (currentDay === i && i <= daysInMonth) {
          option.selected = true;
        }
        daySelect.appendChild(option);
      }
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    document.getElementById('birthYear').addEventListener('change', updateDaysInMonth);
    document.getElementById('birthMonth').addEventListener('change', updateDaysInMonth);

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ zoom ‡πÉ‡∏ô iOS
    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
      const viewport = document.querySelector('meta[name="viewport"]');
      viewport.setAttribute('content', viewport.content + ', user-scalable=no');
    }
  </script>
</body>

</html>